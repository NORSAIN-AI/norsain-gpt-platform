# TypeScript CLI Scripts

This directory contains TypeScript-based CLI tools for managing Custom GPTs.

## Scripts

### `scaffold-gpt.mts`

Creates a new Custom GPT from the template.

**Usage:**

```bash
npm run scaffold <gpt-name> [options]

Options:
  --description <text>    Description of the GPT
  --author <name>         Author name (default: NORSAIN-AI)
```

1. Updates `gpt.json` with provided metadata (name, description, author, tags, created timestamp)
2. Performs targeted placeholder replacements:
   - replaces occurrences of `[GPT Name]` in `instructions/main.md`
   - sets `info.title` and `info.description` in `actions/schema.json`
3. Sets a creation timestamp in `gpt.json`

**Example:**

```bash
npm run scaffold my-assistant --description "A helpful assistant" --tags "helper,assistant"
```

**Validation Rules:**

- Required directories exist (`instructions`, `actions`, `knowledge`) — missing directories are treated as errors.
- `gpt.json` configuration file exists — missing `gpt.json` is an error.
- Knowledge directory has ≤ 20 files — exceeding 20 files is an error; an empty `knowledge/` emits a warning.
- Expected files presence: missing `instructions/main.md` or `actions/schema.json` produce _warnings_ (not blocking),
  while missing directories or `gpt.json` produce _errors_.

### `validate-gpt.mts`

Validates GPT package structure and generates knowledge indexes.

**Usage:**

```bash
npm run validate [gpt-name]

# Validate all GPTs
npm run validate
```

**Functions:**

- `validateGPTStructure()` - Validates GPT directory structure
- `countFiles()` - Counts files in a directory recursively

**Validation Checks:**

- Required directories exist (instructions, actions, knowledge)
- `gpt.json` configuration file exists
- Knowledge directory has ≤ 20 files
- Expected files are present (with warnings)

### `generate-index.mts`

Generates an index.md file listing all knowledge files.

**Usage:**

```bash
npm run generate-index [gpt-name]

# Generate index for specific GPT
npm run generate-index my-assistant

# Generate indexes for all GPTs
npm run generate-index
```

**Output:**

Creates `knowledge/index.md` with:

- A top heading `# Knowledge Base Index` and `Total files: X / 20`
- Grouped file listings (by subdirectory) with headings for each group
- Markdown links to each knowledge file (relative paths)

The index is generated by `scripts/utils/indexing.mts` and will skip hidden files and `index.md` itself.

## Utility Modules

### `utils/scaffolding.mts`

Core scaffolding functionality:

- `scaffoldGPT()` - Creates new GPT from template (copies `gpt-packages/templates/custom_gpt` into `gpt-packages/<name>`
  and applies metadata and replacements)
- `getProjectRoot()` - Gets project root directory

### `utils/validation.mts`

Validation utilities:

- `validateGPTStructure()` - Validates GPT directory structure
- `countFiles()` - Counts files in a directory recursively

### `utils/indexing.mts`

Index generation utilities:

- `generateKnowledgeIndex()` - Scans `knowledge/` recursively and returns non-hidden files (excludes `index.md`)
- `createKnowledgeIndexFile()` - Creates `knowledge/index.md` with headline, file count, and grouped lists

Note: index generation groups files by the first directory level under `knowledge/` and sorts filenames alphabetically.

## Development

### Running Scripts

Scripts use [tsx](https://github.com/esbuild-kit/tsx) for TypeScript execution:

```bash
# Direct execution (for development)
tsx scripts/scaffold-gpt.mts my-assistant

# Via npm scripts (recommended)
npm run scaffold my-assistant
```

### Type Checking

```bash
npm run typecheck
```

### Linting

```bash
npm run lint
```

### Code Formatting

```bash
npm run format
```

## Architecture

All scripts use ES modules (`.mts` extension) with:

- **TypeScript**: For type safety and better developer experience
- **Node.js built-ins**: `fs/promises`, `path`, etc.
- **No external dependencies**: Keeps runtime dependencies minimal

Note about templates: the scaffolder expects templates under `gpt-packages/templates`
(prefer `gpt-packages/templates/custom_gpt`).

Ensure one of these directories exists and contains the template files used to scaffold new GPTs.

## Adding New Scripts

1. Create new `.mts` file in `scripts/`
2. Add corresponding npm script in `package.json`
3. Import utilities from `utils/` as needed
4. Follow existing patterns for CLI arguments and output
5. Add documentation to this README
